var G=Object.defineProperty,J=Object.defineProperties;var K=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var j=(u,e,o)=>e in u?G(u,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):u[e]=o,F=(u,e)=>{for(var o in e||(e={}))q.call(e,o)&&j(u,o,e[o]);if(B)for(var o of B(e))H.call(e,o)&&j(u,o,e[o]);return u},$=(u,e)=>J(u,K(e));var N=(u,e)=>{var o={};for(var r in u)q.call(u,r)&&e.indexOf(r)<0&&(o[r]=u[r]);if(u!=null&&B)for(var r of B(u))e.indexOf(r)<0&&H.call(u,r)&&(o[r]=u[r]);return o};import{r as t,R as Q,T as U,j as l,a as s,V as X,i as Y,a5 as Z,u as uu}from"./index.2b4138e2.js";import{l as V,s as W}from"./functions.bac916fb.js";import{u as eu,M as ou,a as ru,b as su,c as au,d as tu,e as nu,F as x,f as w,I as S,g as D,h as v,i as cu}from"./index.esm.b2a4f74e.js";import{u as iu,c as du,b as lu}from"./toast.6bee113f.js";import{B as O}from"./chakra-ui-button.esm.311a4802.js";function mu(u,e){const o=t.exports.useCallback(a=>a instanceof Function?a():a,[]),[r,C]=t.exports.useState(()=>{if(window===void 0)return o(e);try{const a=V(u);return a===null?o(e):a}catch(a){return console.error(a),o(e)}}),i=t.exports.useCallback(a=>{try{const c=a instanceof Function?a(r):a;C(c),window!==void 0&&W(u,c)}catch(c){console.error(c)}},[u,r]);return[r,i]}function pu(){const u=iu();return t.exports.useCallback(async o=>{try{return await du(async()=>{const{ok:r}=await u.validateRoom(o.roomId,o.passcode);return r?"success":"invalid-passcode"},{retries:4})}catch(r){if(console.error(r),r instanceof Q)switch(r.status){case 404:return"room-not-found";default:return"other-error"}else return r instanceof U?"connection-error":"other-error"}},[u])}function Cu(C){var i=C,{defaultValues:u,onSubmit:e,onClose:o}=i,r=N(i,["defaultValues","onSubmit","onClose"]);var T,L,P;const{handleSubmit:a,register:c,reset:h,setError:m,setFocus:M,formState:{errors:d,isSubmitting:E,isSubmitted:k}}=eu({defaultValues:u}),b=t.exports.useCallback((n,p)=>{m(n,{type:"manual",message:p}),M(n)},[m,M]),f=t.exports.useMemo(()=>Fu(u),[u]),A=lu(),y=pu(),g=t.exports.useCallback((n,p)=>{const z=p-n;return Math.random()*z+n},[]),I=t.exports.useCallback(async n=>{console.log("sleep:",n),await new Promise(p=>{setTimeout(p,n)})},[]),_=t.exports.useCallback(async n=>{switch(await y(n)){case"success":await e(n);break;case"room-not-found":await I(g(500,1e3)),b("roomId","\u30EB\u30FC\u30E0\u304C\u3042\u308A\u307E\u305B\u3093");break;case"invalid-passcode":await I(g(500,1e3)),b("passcode","\u30D1\u30B9\u30B3\u30FC\u30C9\u304C\u9055\u3044\u307E\u3059");break;case"connection-error":A({description:"\u63A5\u7D9A\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F\u3002\u3057\u3070\u3089\u304F\u7D4C\u3063\u3066\u304B\u3089\u518D\u5EA6\u304A\u8A66\u3057\u304F\u3060\u3055\u3044\u3002"});break;case"other-error":A({description:"\u4E0D\u660E\u306A\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F\u3002\u3057\u3070\u3089\u304F\u7D4C\u3063\u3066\u304B\u3089\u518D\u5EA6\u304A\u8A66\u3057\u304F\u3060\u3055\u3044\u3002"});break}},[e,g,b,I,y,A]),R=t.exports.useCallback(()=>{h(),o()},[o,h]);return l(ou,$(F({},r),{onClose:R,children:[s(ru,{}),l(su,{children:[s(au,{children:"\u30EB\u30FC\u30E0\u306B\u53C2\u52A0\u3059\u308B"}),s(tu,{}),l("form",{onSubmit:a(_),children:[s(nu,{children:l(X,{spacing:"8",children:[l(x,{isInvalid:d.roomId!==void 0,children:[s(w,{htmlFor:"input-room-id",children:"\u30EB\u30FC\u30E0\u306EID"}),s(S,F({id:"input-room-id",autoFocus:f==="roomId",disabled:E},c("roomId",{required:"\u5FC5\u9808\u5165\u529B\u3067\u3059"}))),((T=d.roomId)==null?void 0:T.message)&&k?s(D,{children:d.roomId.message}):s(v,{children:"\u53C2\u52A0\u3059\u308B\u30EB\u30FC\u30E0\u306EID\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044"})]}),l(x,{isInvalid:d.passcode!==void 0,children:[s(w,{htmlFor:"input-passcode",children:"\u30D1\u30B9\u30B3\u30FC\u30C9"}),s(S,F({id:"input-passcode",type:"password",autoFocus:f==="passcode",autoComplete:"off",disabled:E},c("passcode",{required:"\u5FC5\u9808\u5165\u529B\u3067\u3059"}))),((L=d.passcode)==null?void 0:L.message)&&k?s(D,{children:d.passcode.message}):s(v,{children:"\u30EB\u30FC\u30E0\u306E\u30D1\u30B9\u30B3\u30FC\u30C9\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044"})]}),l(x,{isInvalid:d.nickname!==void 0,children:[s(w,{htmlFor:"input-nickname",children:"\u30CB\u30C3\u30AF\u30CD\u30FC\u30E0"}),s(S,F({id:"input-nickname",autoFocus:f==="nickname",disabled:E},c("nickname",{required:"\u5FC5\u9808\u5165\u529B\u3067\u3059"}))),((P=d.nickname)==null?void 0:P.message)&&k?s(D,{children:d.nickname.message}):s(v,{children:"\u3042\u306A\u305F\u306E\u30CB\u30C3\u30AF\u30CD\u30FC\u30E0\u3092\u6307\u5B9A\u3057\u3066\u304F\u3060\u3055\u3044"})]})]})}),s(cu,{children:l(Y,{children:[s(O,{variant:"ghost",onClick:R,children:"\u30AD\u30E3\u30F3\u30BB\u30EB"}),s(O,{colorScheme:"blue",type:"submit",isLoading:E,children:"\u53C2\u52A0\u3059\u308B"})]})})]})]})]}))}function Fu(u){return u.roomId?u.passcode?"nickname":"passcode":"roomId"}function gu(){const[u]=Z(),e=u.get("r");let o=u.get("p");const[r,C]=mu("nickname",""),i=uu(),a=t.exports.useCallback(()=>{i("/",{replace:!0})},[i]),c=t.exports.useCallback(async m=>{W(`passcodes.${e}`,m.passcode),C(m.nickname),i(`/room/${m.roomId}`,{replace:!0})},[i,e,C]);!o&&e&&(o=V(`passcodes.${e}`));const h=t.exports.useMemo(()=>({roomId:e||"",passcode:o||"",nickname:r}),[r,o,e]);return s(Cu,{isOpen:!0,onClose:a,onSubmit:c,defaultValues:h})}export{gu as default};
